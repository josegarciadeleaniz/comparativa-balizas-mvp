const salesPoints = [
  {
    "id_punto": 1,
    "nombre_punto": "Alcampo",
    "marca": "Help Flash IoT",
    "precio_venta": 49.95,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "alcampo.es"
  },
  {
    "id_punto": 2,
    "nombre_punto": "Aldi",
    "marca": "Baliza V16 IoT Aldi",
    "precio_venta": 39.99,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "aldi.es"
  },
  {
    "id_punto": 3,
    "nombre_punto": "Amazon",
    "marca": "Flash Mate",
    "precio_venta": 49.99,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "amazon.es"
  },
  {
    "id_punto": 3,
    "nombre_punto": "Amazon",
    "marca": "Help Flash IoT",
    "precio_venta": 46.50,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "amazon.es"
  },
  {
    "id_punto": 3,
    "nombre_punto": "Amazon",
    "marca": "SOOS V16",
    "precio_venta": 48.60,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "amazon.es"
  },
  {
    "id_punto": 4,
    "nombre_punto": "Arval",
    "marca": "Help Flash V16",
    "precio_venta": 54.90,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "arval.es"
  },
  {
    "id_punto": 5,
    "nombre_punto": "Aurgi",
    "marca": "SOS Flash Connected",
    "precio_venta": 44.95,
    "alimentacion": "3x AAA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "aurgi.com"
  },
  {
    "id_punto": 6,
    "nombre_punto": "BMW",
    "marca": "Help Flash V16",
    "precio_venta": 54.90,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "bmw.es"
  },
  {
    "id_punto": 7,
    "nombre_punto": "BP",
    "marca": "iWottoLight IoT",
    "precio_venta": 39.99,
    "alimentacion": "3x AAA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "bp.com"
  },
  {
    "id_punto": 8,
    "nombre_punto": "Carrefour",
    "marca": "Help Flash IoT",
    "precio_venta": 44.00,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "carrefour.es"
  },
  {
    "id_punto": 8,
    "nombre_punto": "Carrefour",
    "marca": "iWottoLight IoT",
    "precio_venta": 39.99,
    "alimentacion": "3x AAA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "carrefour.es"
  },
  {
    "id_punto": 8,
    "nombre_punto": "Carrefour",
    "marca": "PMK Grupo",
    "precio_venta": 49.90,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "carrefour.es"
  },
  {
    "id_punto": 8,
    "nombre_punto": "Carrefour",
    "marca": "SOOS V16",
    "precio_venta": 48.60,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "carrefour.es"
  },
  {
    "id_punto": 9,
    "nombre_punto": "Correos",
    "marca": "BALIZA3e V-16/SMART MOD100",
    "precio_venta": 59.99,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "correos.es"
  },
  {
    "id_punto": 10,
    "nombre_punto": "Costco",
    "marca": "Geoblueshield49",
    "precio_venta": 54.95,
    "alimentacion": "1x 9V",
    "marca_pilas": "Energizer",
    "desconectable": "si",
    "funda": "si",
    "fuente_oficial": "costco.es"
  },
  {
    "id_punto": 11,
    "nombre_punto": "eBay",
    "marca": "FlashLED SOS V16",
    "precio_venta": 69.90,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "ebay.es"
  },
  {
    "id_punto": 11,
    "nombre_punto": "eBay",
    "marca": "Hella V16",
    "precio_venta": 51.99,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "ebay.es"
  },
  {
    "id_punto": 11,
    "nombre_punto": "eBay",
    "marca": "Help Flash V16",
    "precio_venta": 52.00,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "ebay.es"
  },
  {
    "id_punto": 11,
    "nombre_punto": "eBay",
    "marca": "Osram LEDguardian V16",
    "precio_venta": 51.99,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "ebay.es"
  },
  {
    "id_punto": 12,
    "nombre_punto": "El Corte Inglés",
    "marca": "Car-Lite",
    "precio_venta": 59.90,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "elcorteingles.es"
  },
  {
    "id_punto": 12,
    "nombre_punto": "El Corte Inglés",
    "marca": "Help Flash IoT",
    "precio_venta": 54.95,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "elcorteingles.es"
  },
  {
    "id_punto": 12,
    "nombre_punto": "El Corte Inglés",
    "marca": "Uirax V16 2.0 IoT",
    "precio_venta": 39.99,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "elcorteingles.es"
  },
  {
    "id_punto": 13,
    "nombre_punto": "Ford",
    "marca": "EmergLight Geo IoT",
    "precio_venta": 43.95,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "ford.es"
  },
  {
    "id_punto": 14,
    "nombre_punto": "Generali",
    "marca": "Help Flash IoT",
    "precio_venta": 42.17,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "generali.es"
  },
  {
    "id_punto": 15,
    "nombre_punto": "Itevelesa (estaciones)",
    "marca": "Help Flash IoT",
    "precio_venta": 49.95,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "itevelesa.com"
  },
  {
    "id_punto": 16,
    "nombre_punto": "Iveco",
    "marca": "Help Flash V16",
    "precio_venta": 54.90,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "iveco.com"
  },
  {
    "id_punto": 17,
    "nombre_punto": "Kia",
    "marca": "Baliza V16 Geolocalizada Kia",
    "precio_venta": 48.96,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "kia.com"
  },
  {
    "id_punto": 18,
    "nombre_punto": "Leroy Merlin",
    "marca": "Help Flash IoT",
    "precio_venta": 52.99,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "leroymerlin.es"
  },
  {
    "id_punto": 18,
    "nombre_punto": "Leroy Merlin",
    "marca": "Ledone Connected",
    "precio_venta": 52.99,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "leroymerlin.es"
  },
  {
    "id_punto": 18,
    "nombre_punto": "Leroy Merlin",
    "marca": "PMK Grupo",
    "precio_venta": 49.90,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "leroymerlin.es"
  },
  {
    "id_punto": 19,
    "nombre_punto": "Lidl",
    "marca": "Help Flash IoT",
    "precio_venta": 49.95,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "lidl.es"
  },
  {
    "id_punto": 20,
    "nombre_punto": "Makro",
    "marca": "Ledone Connected",
    "precio_venta": 54.93,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "makro.es"
  },
  {
    "id_punto": 21,
    "nombre_punto": "MAPFRE (Club)",
    "marca": "Help Flash IoT",
    "precio_venta": 39.95,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "mapfre.com"
  },
  {
    "id_punto": 22,
    "nombre_punto": "MediaMarkt",
    "marca": "FlashLED SOS V16",
    "precio_venta": 59.95,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "mediamarkt.es"
  },
  {
    "id_punto": 22,
    "nombre_punto": "MediaMarkt",
    "marca": "Help Flash IoT",
    "precio_venta": 45.94,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "mediamarkt.es"
  },
  {
    "id_punto": 22,
    "nombre_punto": "MediaMarkt",
    "marca": "NK SOS Road Connected",
    "precio_venta": 51.49,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "mediamarkt.es"
  },
  {
    "id_punto": 22,
    "nombre_punto": "MediaMarkt",
    "marca": "Planet V16",
    "precio_venta": 47.75,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "mediamarkt.es"
  },
  {
    "id_punto": 22,
    "nombre_punto": "MediaMarkt",
    "marca": "SOOS V16",
    "precio_venta": 48.60,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "mediamarkt.es"
  },
  {
    "id_punto": 23,
    "nombre_punto": "Mercedes",
    "marca": "Help Flash IoT",
    "precio_venta": 54.90,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "mercedes-benz.es"
  },
  {
    "id_punto": 24,
    "nombre_punto": "Moeve",
    "marca": "Help Flash V16",
    "precio_venta": 54.95,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "moeve.es"
  },
  {
    "id_punto": 25,
    "nombre_punto": "Norauto",
    "marca": "FlashLED SOS V16",
    "precio_venta": 59.95,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "norauto.es"
  },
  {
    "id_punto": 25,
    "nombre_punto": "Norauto",
    "marca": "Hella V16",
    "precio_venta": 51.99,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "norauto.es"
  },
  {
    "id_punto": 25,
    "nombre_punto": "Norauto",
    "marca": "Help Flash IoT",
    "precio_venta": 49.95,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "norauto.es"
  },
  {
    "id_punto": 25,
    "nombre_punto": "Norauto",
    "marca": "SOS Road Connected",
    "precio_venta": 49.99,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "norauto.es"
  },
  {
    "id_punto": 26,
    "nombre_punto": "Orange",
    "marca": "NK SOS Road Connected",
    "precio_venta": 51.99,
    "alimentacion": "3x AA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "orange.es"
  },
  {
    "id_punto": 27,
    "nombre_punto": "Renault",
    "marca": "Help Flash V16",
    "precio_venta": 54.90,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "renault.es"
  },
  {
    "id_punto": 27,
    "nombre_punto": "Renault (concesionario)",
    "marca": "Help Flash V16",
    "precio_venta": 54.90,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "renault.es"
  },
  {
    "id_punto": 28,
    "nombre_punto": "Repsol",
    "marca": "Ledone Connected",
    "precio_venta": 45.00,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "repsol.es"
  },
  {
    "id_punto": 29,
    "nombre_punto": "SEAT (concesionario)",
    "marca": "Help Flash V16",
    "precio_venta": 54.90,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "seat.es"
  },
  {
    "id_punto": 30,
    "nombre_punto": "Telefónica/Movistar",
    "marca": "Fase Light V16",
    "precio_venta": 45.99,
    "alimentacion": "3x AAA",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "movistar.es"
  },
  {
    "id_punto": 30,
    "nombre_punto": "Telefónica/Movistar",
    "marca": "FlashLED SOS V16",
    "precio_venta": 59.95,
    "alimentacion": "1x 9V",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "movistar.es"
  },
  {
    "id_punto": 31,
    "nombre_punto": "Toyota",
    "marca": "Señal luminosa V16 Toyota",
    "precio_venta": 49.95,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "toyota.es"
  },
  {
    "id_punto": 32,
    "nombre_punto": "Vodafone",
    "marca": "Help Flash IoT",
    "precio_venta": 49.95,
    "alimentacion": "4x AA",
    "marca_pilas": "Marca Blanca",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "vodafone.es"
  },
  {
    "id_punto": 32,
    "nombre_punto": "Vodafone",
    "marca": "Ledone Connected",
    "precio_venta": 52.99,
    "alimentacion": "1x 9V",
    "marca_pilas": "No",
    "desconectable": "no",
    "funda": "no",
    "fuente_oficial": "vodafone.es"
  }
]
const beacons = [
  {
    "id_marca": 1,
    "nombre_marca": "Geoblueshield49",
    "pais": "España",
    "actuacion": "Fabrica",
    "pvp": 54.95,
    "alimentacion": "9V",
    "marca_bateria": "Energizer",
    "desconectable": "Si",
    "funda": "Si"
  },
  {
    "id_marca": 2,
    "nombre_marca": "Helios v16 beacon",
    "pais": "China",
    "actuacion": "Fabrica",
    "pvp": 39.90,
    "alimentacion": "3x AA",
    "marca_bateria": "No",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 3,
    "nombre_marca": "Geobaliza beacon V16",
    "pais": "China",
    "actuacion": "Fabrica",
    "pvp": 38.90,
    "alimentacion": "3x AAA",
    "marca_bateria": "No",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 4,
    "nombre_marca": "Light Mup beacon",
    "pais": "China",
    "actuacion": "Fabrica",
    "pvp": 46.00,
    "alimentacion": "3x AAA",
    "marca_bateria": "No",
    "desconectable": "No",
    "funda": "Si"
  },
  {
    "id_marca": 5,
    "nombre_marca": "SOS Traffic",
    "pais": "España",
    "actuacion": "Fabrica",
    "pvp": 49.95,
    "alimentacion": "9V",
    "marca_bateria": "Marca Blanca",
    "desconectable": "Si",
    "funda": "No"
  },
  {
    "id_marca": 6,
    "nombre_marca": "Fase Light V16",
    "pais": "España",
    "actuacion": "Ensamblaje",
    "pvp": 45.99,
    "alimentacion": "3x AAA",
    "marca_bateria": "Incluidas",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 7,
    "nombre_marca": "SOS Flash Connected",
    "pais": "España",
    "actuacion": "Ensamblaje",
    "pvp": 44.95,
    "alimentacion": "3x AAA",
    "marca_bateria": "Incluidas",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 8,
    "nombre_marca": "Hero Driver",
    "pais": "España",
    "actuacion": "Ensamblaje",
    "pvp": 49.90,
    "alimentacion": "n/a",
    "marca_bateria": "No",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 9,
    "nombre_marca": "Car-Lite",
    "pais": "España",
    "actuacion": "Ensamblaje",
    "pvp": 59.90,
    "alimentacion": "9V",
    "marca_bateria": "No",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 10,
    "nombre_marca": "FlashLED SOS V16",
    "pais": "España",
    "actuacion": "Ensamblaje",
    "pvp": 49.90,
    "alimentacion": "9V",
    "marca_bateria": "Marca Blanca",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 11,
    "nombre_marca": "Osram LEDguardian V16",
    "pais": "China",
    "actuacion": "Fabrica",
    "pvp": 51.99,
    "alimentacion": "9V",
    "marca_bateria": "Marca Blanca",
    "desconectable": "n/a",
    "funda": "No"
  },
  {
    "id_marca": 12,
    "nombre_marca": "Help Flash IoT 9V",
    "pais": "España",
    "actuacion": "Ensamblaje",
    "pvp": 49.95,
    "alimentacion": "4x AAA",
    "marca_bateria": "Marca Blanca",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 13,
    "nombre_marca": "Ledone Connected",
    "pais": "España",
    "actuacion": "Fabrica",
    "pvp": 52.99,
    "alimentacion": "9V",
    "marca_bateria": "No",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 14,
    "nombre_marca": "Hella V16",
    "pais": "China",
    "actuacion": "Fabrica",
    "pvp": 51.99,
    "alimentacion": "9V",
    "marca_bateria": "No",
    "desconectable": "No",
    "funda": "No"
  },
  {
    "id_marca": 15,
    "nombre_marca": "KSIX V16 IoT GPS",
    "pais": "España",
    "actuacion": "Ensamblaje",
    "pvp": 49.90,
    "alimentacion": "9V",
    "marca_bateria": "No",
    "desconectable": "No",
    "funda": "No"
  }
]
const batteries = [
{
  "formulario_pilas": {
    "secciones": [
      {
        "titulo": "Configuración de Pilas",
        "preguntas": [
          {
            "id": 1,
            "pregunta": "¿Qué tipo de alimentación utiliza la baliza?",
            "tipo": "selector",
            "opciones": [
              "3x AAA",
              "4x AAA", 
              "3x AA",
              "4x AA",
              "9V Alcalina",
              "9V No alcalina",
              "Otro (especificar)"
            ],
            "requerido": true
          }
        ]
      },
      {
        "titulo": "Marca de las Pilas",
        "preguntas": [
          {
            "id": 2,
            "pregunta": "¿Las pilas son de marca reconocida?",
            "tipo": "selector",
            "opciones": [
              "Energizer",
              "Duracell",
              "Varta",
              "Marca Blanca",
              "Chinas genéricas",
              "Otras (especificar)"
            ],
            "requerido": true
          }
        ]
      },
      {
        "titulo": "Características de Seguridad",
        "preguntas": [
          {
            "id": 3,
            "pregunta": "¿La baliza permite desconectar los polos para evitar contacto permanente con las pilas?",
            "explicacion": "Esta función previene fugas de batería y corrosión cuando no se usa la baliza",
            "tipo": "radio",
            "opciones": [
              {"valor": "si", "label": "Sí"},
              {"valor": "no", "label": "No"}
            ],
            "requerido": true
          },
          {
            "id": 4,
            "pregunta": "¿Incluye funda térmica para protección contra temperaturas extremas?",
            "tipo": "radio",
            "opciones": [
              {"valor": "si", "label": "Sí"},
              {"valor": "no", "label": "No"}
            ],
            "requerido": true
          }
        ]
      },
      {
        "titulo": "Datos Adicionales (Opcionales)",
        "preguntas": [
          {
            "id": 5,
            "pregunta": "¿Cuánto te costó la baliza? (€)",
            "tipo": "numero",
            "requerido": false
          },
          {
            "id": 6,
            "pregunta": "¿Dónde la compraste?",
            "tipo": "texto",
            "requerido": false
          },
          {
            "id": 7,
            "pregunta": "Marca de la baliza",
            "tipo": "texto",
            "requerido": false
          }
        ]
      }
    ],
    "algoritmo_riesgo": {
      "parametros": [
        {
          "nombre": "calidad_pilas",
          "peso": 0.4,
          "escala": {
            "Energizer/Duracell": 1,
            "Varta": 1.2,
            "Marca Blanca": 1.8,
            "Chinas genéricas": 2.5
          }
        },
        {
          "nombre": "desconexion_polos",
          "peso": 0.3,
          "escala": {
            "si": 1,
            "no": 2
          }
        },
        {
          "nombre": "proteccion_termica",
          "peso": 0.2,
          "escala": {
            "si": 1,
            "no": 1.5
          }
        },
        {
          "nombre": "tipo_alimentacion",
          "peso": 0.1,
          "escala": {
            "9V Alcalina": 1,
            "4x AA": 1.1,
            "3x AA": 1.2,
            "4x AAA": 1.3,
            "3x AAA": 1.4,
            "9V No alcalina": 1.8
          }
        }
      ],
      "formula": "(calidad_pilas * 0.4) + (desconexion_polos * 0.3) + (proteccion_termica * 0.2) + (tipo_alimentacion * 0.1)",
      "niveles_riesgo": [
        {"rango": "1-1.4", "clasificacion": "Bajo riesgo", "multiplicador_multa": 1},
        {"rango": "1.5-2.2", "clasificacion": "Riesgo moderado", "multiplicador_multa": 2},
        {"rango": "2.3-3.5", "clasificacion": "Alto riesgo", "multiplicador_multa": 3},
        {"rango": ">3.5", "clasificacion": "Riesgo muy alto", "multiplicador_multa": 4}
      ]
    },
    "api_integration": {
      "endpoint": "https://api.openai.com/v1/chat/completions",
      "prompt_template": "Evalúa el riesgo de obsolescencia y posibles multas para una baliza V16 con las siguientes características:\n- Tipo de pilas: {tipo_pilas}\n- Marca pilas: {marca_pilas}\n- Desconexión polos: {desconexion_polos}\n- Funda térmica: {funda_termica}\n\nConsidera estos factores:\n1. Calidad de pilas (penalización por fugas)\n2. Riesgo de corrosión\n3. Protección contra temperaturas extremas\n4. Vida útil estimada\n\nProporciona:\n- Índice de riesgo calculado: {indice_riesgo}\n- Multiplicador de multa aplicable: x{multiplicador_multa}\n- Recomendaciones técnicas\n- Alternativas de mejora"
    }
  }
}
];
const endpoint = 'https://baliza-api-on-render.onrender.com/api/calcula';
let context = null;

function initApp() {
  const choices      = document.querySelectorAll('.choice');
  const formA        = document.getElementById('formA');
  const formB        = document.getElementById('formB');
  const formC        = document.getElementById('formC');
  const resultado    = document.getElementById('resultado');
  const backButtons  = document.querySelectorAll('.btn-back');

  // B) Rellenar select de balizas
  const selBeacon = document.getElementById('selectBeacon');
  beacons.forEach(b => {
    selBeacon.add(new Option(`${b.modelo} — ${b.pvp} €`, b.id_beacon));
  });

  // C) Rellenar tienda/modelo
  const selTienda       = document.getElementById('selectTienda');
  const selModeloTienda = document.getElementById('selectModeloTienda');
  [...new Set(salesPoints.map(s=>s.nombre_punto))]
    .forEach(p => selTienda.add(new Option(p, p)));
  selTienda.addEventListener('change', () => {
    selModeloTienda.innerHTML = '';
    selModeloTienda.disabled   = false;
    salesPoints
      .filter(s => s.nombre_punto === selTienda.value)
      .forEach(s => {
        selModeloTienda.add(new Option(`${s.marca} — ${s.precio_venta} €`, s.marca));
      });
  });

  // Mostrar formulario según elección
  choices.forEach(choice => {
    choice.addEventListener('click', () => {
      choices.forEach(c=>c.classList.remove('selected'));
      choice.classList.add('selected');
      context = choice.dataset.ctx;
      [formA, formB, formC].forEach(f=>f.classList.remove('active'));
      if (context==='A') formA.classList.add('active');
      if (context==='B') formB.classList.add('active');
      if (context==='C') formC.classList.add('active');
      resultado.textContent = '';
    });
  });

  // Botones Volver
  backButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      [formA,formB,formC].forEach(f=>f.classList.remove('active'));
      choices.forEach(c=>c.classList.remove('selected'));
      context = null;
      resultado.textContent = '';
    });
  });

  // Envío
  [formA,formB,formC].forEach(form => {
    form.addEventListener('submit', async e => {
      e.preventDefault();
      const data = { context };
      new FormData(form).forEach((val,key)=>data[key]=val);

      if (context==='B') {
        const b = beacons.find(x=>x.id_beacon==data.modelo);
        data.tipo_pilas  = b.tipo_pilas;
        data.desconecta  = b.desconecta;
        data.funda       = b.funda_térmica;
        data.pvp         = b.pvp;
        data.packCost    = b.packCost;
      }
      if (context==='C') {
        const sp = salesPoints.find(x=>
          x.nombre_punto===data.tienda && x.marca===data.modelo_tienda
        );
        data.tipo_pilas   = sp.alimentación;
        data.desconecta   = sp.desconectable;
        data.funda        = sp.funda;
        data.precio_venta = sp.precio_venta;
      }

      resultado.textContent = 'Cargando…';
      try {
        const res  = await fetch(endpoint,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        const json = await res.json();
        resultado.textContent = JSON.stringify(json,null,2);
      } catch {
        resultado.textContent = 'Error al conectar con la API';
      }
    });
  });
}

document.addEventListener('DOMContentLoaded', initApp);